{"version":3,"sources":["../src/lib/pivot/export.ts"],"names":[],"mappings":"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","file":"chunk-6M575PJF.js","sourcesContent":["/**\n * Export utilities for pivot data\n * Supports CSV, Excel, and JSON formats\n */\n\nimport type { ExportFormat } from './schemas'\n\n/**\n * Export pivot data to different formats\n */\nexport async function exportPivotData(\n  data: any[],\n  format: ExportFormat\n): Promise<string | Blob> {\n  switch (format) {\n    case 'csv':\n      return generateCSV(data)\n\n    case 'excel':\n      return await generateExcel(data)\n\n    case 'json':\n      return JSON.stringify(data, null, 2)\n\n    default:\n      throw new Error(`Unsupported export format: ${format}`)\n  }\n}\n\n/**\n * Generate CSV from pivot data\n */\nexport function generateCSV(data: any[]): string {\n  if (data.length === 0) return ''\n\n  // Get all keys (columns)\n  const keys = Object.keys(data[0]).filter(key => !key.startsWith('__'))\n\n  // Create header row\n  const header = keys.join(',')\n\n  // Create data rows\n  const rows = data.map(row => {\n    return keys.map(key => {\n      const value = row[key]\n      // Handle values with commas or quotes\n      if (value === null || value === undefined) return ''\n      const strValue = String(value)\n      if (strValue.includes(',') || strValue.includes('\"') || strValue.includes('\\n')) {\n        return `\"${strValue.replace(/\"/g, '\"\"')}\"`\n      }\n      return strValue\n    }).join(',')\n  })\n\n  return [header, ...rows].join('\\n')\n}\n\n/**\n * Generate Excel file from pivot data\n * Returns a Blob that can be downloaded\n *\n * @requires exceljs - Make sure to install exceljs as an optional dependency\n */\nexport async function generateExcel(data: any[]): Promise<Blob> {\n  const ExcelJS = await import('exceljs')\n  const workbook = new ExcelJS.Workbook()\n  const worksheet = workbook.addWorksheet('Pivot Data')\n\n  if (data.length === 0) {\n    return new Blob([], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' })\n  }\n\n  // Get columns\n  const keys = Object.keys(data[0]).filter(key => !key.startsWith('__'))\n\n  // Add header row\n  worksheet.addRow(keys)\n\n  // Style header\n  worksheet.getRow(1).font = { bold: true }\n  worksheet.getRow(1).fill = {\n    type: 'pattern',\n    pattern: 'solid',\n    fgColor: { argb: 'FFE0E0E0' }\n  }\n\n  // Add data rows\n  data.forEach(row => {\n    const values = keys.map(key => row[key])\n    const excelRow = worksheet.addRow(values)\n\n    // Style total rows\n    if (row.__isGrandTotal || row.__isSubtotal) {\n      excelRow.font = { bold: true }\n      excelRow.fill = {\n        type: 'pattern',\n        pattern: 'solid',\n        fgColor: { argb: row.__isGrandTotal ? 'FFFFEB3B' : 'FFFFFFFF' }\n      }\n    }\n  })\n\n  // Auto-fit columns\n  worksheet.columns.forEach(column => {\n    let maxLength = 0\n    column.eachCell?.({ includeEmpty: false }, cell => {\n      const length = String(cell.value).length\n      if (length > maxLength) {\n        maxLength = length\n      }\n    })\n    column.width = Math.min(maxLength + 2, 50)\n  })\n\n  // Generate buffer\n  const buffer = await workbook.xlsx.writeBuffer()\n  return new Blob([buffer], {\n    type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'\n  })\n}\n\n/**\n * Get unique values for a specific field\n * Useful for populating filter dropdowns\n */\nexport function getUniqueFieldValues(data: any[], field: string): string[] {\n  const uniqueValues = new Set<string>()\n\n  for (const row of data) {\n    if (row[field] !== null && row[field] !== undefined) {\n      uniqueValues.add(String(row[field]))\n    }\n  }\n\n  return Array.from(uniqueValues).sort()\n}\n\n/**\n * Get available fields from the data source\n * Returns field names and their types\n */\nexport function getAvailableFields(data: any[]): Array<{ name: string; type: string }> {\n  if (data.length === 0) {\n    return []\n  }\n\n  const firstRow = data[0]\n  const fields = Object.keys(firstRow).map(name => {\n    const value = firstRow[name]\n    let type = 'string'\n\n    if (typeof value === 'number') {\n      type = 'number'\n    } else if (value instanceof Date) {\n      type = 'date'\n    } else if (typeof value === 'boolean') {\n      type = 'boolean'\n    }\n\n    return { name, type }\n  })\n\n  return fields\n}\n\n/**\n * Download a blob as a file\n * Helper for client-side file downloads\n */\nexport function downloadBlob(blob: Blob, filename: string): void {\n  const url = URL.createObjectURL(blob)\n  const link = document.createElement('a')\n  link.href = url\n  link.download = filename\n  document.body.appendChild(link)\n  link.click()\n  document.body.removeChild(link)\n  URL.revokeObjectURL(url)\n}\n\n/**\n * Download a string as a file\n * Helper for client-side file downloads\n */\nexport function downloadString(content: string, filename: string, mimeType: string = 'text/plain'): void {\n  const blob = new Blob([content], { type: mimeType })\n  downloadBlob(blob, filename)\n}\n"]}